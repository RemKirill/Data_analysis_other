---
title: "Task5"
author: "Redkokosh Kirill"
date: "11/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
df <- read.table('bakery.dat', header = TRUE, sep="\t") 
head(df)
summary(df[-1])
```

##Коротко о данных:

Данные о 25 хлебобулочных продуктах из пекарни Brumby's. Даны 8 харатеристик для каждого:

Энергия (в килоджоулях)

Белок (в граммах)

Жир (в граммах)

Всего углеводов (в г)

Сахар (в граммах)

Пищевые волокна (в граммах)

Натрий (в миллиграммах)

Калий (в миллиграммах)

В связи со сложностями в интерпретации натрия и каоия уберем их из рассмотрения.

```{r}
library(lattice)
library(ggplot2)
library('GGally')
ggpairs(df, title="correlogram", columns=c(2:7), upper = list(continuous = "points"), diag = list(continuous = "barDiag"))
```

Не будем логорифмировать данные или каким-либо ещё образом их предобрабатывать. На outliers посмотрим на графике $\mathsf{Z}$.

Так как признаки измерены в разных шкалах, то их необходимо стандартизоавть.

```{r}
library("factoextra")
library("FactoMineR")
res.pca <- PCA(df[c(-1,-8,-9)], scale.unit = TRUE, ncp = 3, graph= FALSE)
get_eigenvalue(res.pca)
fviz_eig(res.pca)
```

Сумма собственных чисел = количеству признаков, значит АГК по корреляционной матрице (scale.unit = TRUE).

Информативность первых 2 главных компонент более 75%. На первые 3 компоненты приходится около 90%, поэтому будем интерпретировать 3 компоненты (попробуем, по крайней мере).

Для интерпретации главных компонент рассмотрим матрицу $\mathsf{U}$ (столбцы соответсвуют векторам $U_1,...,U_3$).

```{r}
res.pca$svd$V
```

Первая компонента -- разница между "энергетической составляющей" (энергия+жир+углеводы+сахар) и "полезной" (белок+пищевые волокна).

Вторая -- разница между всеми составляющими и углеводами.

Третья -- энергия+белок+углеводы - (сахар+пищевые волокна).

Рассмотрим диаграмму факторных весов (для первых двух компонент) -- $\mathsf{F}$ (сумма квадратов по $i$-ому столбцу равна $\lambda_i$).

```{r}
head(get_pca_var(res.pca)$coord, 8)
fviz_pca_var(res.pca, col.var = "darkgreen")
fviz_cos2(res.pca, choice = "var", axes = 1:2)
```

Длина всех векторов близка к 1, это значит, что все эти признаки хорошо описываются 2 первыми главными компонентами. Для подтверждения рассмотрим также $cos^2(\angle(X_i, V_j)) = f_{ij}^2 = cor_{i,j}^2$ этих векторов. 

Рассмотрим матрицу главных компонент -- $\mathsf{Z}$ и её визуализацию.

```{r}
head(res.pca$ind$coord)
fviz_pca_biplot(res.pca)
```

Стрелочки -- проекции ортов. Рассматривая индивида необходимо смотреть на то с какой стороны относительно стрелочки какого-либо признака он находится. Например, рассмотрим морковный кекс (под номером 5), согласно графику у него должны быть большие значения Enegry, Fat, Sugars (они и вправду близки к максимальным по выборке), среднее значение Total.Carbo (почти mean по выборке) и значения ниже среднего Fibre, Protein (так и есть).

Рассмотрим также индивида под номером 23-- медовый хлеб с семечками, много пищевых волокон (близко к максимуму по выборке), значения выше среднего-- белок и жиры (по выборке-- примерно значение 3 квартиля), среднее значение-- энергии (совпадает со средним значением по выборке), меньше среднего-- сахара (меньше среднего по выборке), минимальное количество углеводов (на самом деле минимум по выборке). Выделяется наименьшим показателем углеводов при этом имея достаточно высокие показатели почти всех других признаков (исключая сахара). С названием этого хлебобулочного изделия (медовый хлеб с семечками) выводы по АГК хорошо соотносятся.